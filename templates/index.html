<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Smart Calculator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<div class="app">
    <div class="display" id="display">0</div>

    <div class="buttons">
        <button class="btn function" onclick="clearAll()">C</button>
        <button class="btn function" onclick="backspace()">⌫</button>
        <button class="btn function" onclick="percent()">%</button>
        <button class="btn operator" onclick="setOperator('/')">÷</button>

        <button class="btn" onclick="appendNumber('7')">7</button>
        <button class="btn" onclick="appendNumber('8')">8</button>
        <button class="btn" onclick="appendNumber('9')">9</button>
        <button class="btn operator" onclick="setOperator('*')">×</button>

        <button class="btn" onclick="appendNumber('4')">4</button>
        <button class="btn" onclick="appendNumber('5')">5</button>
        <button class="btn" onclick="appendNumber('6')">6</button>
        <button class="btn operator" onclick="setOperator('-')">−</button>

        <button class="btn" onclick="appendNumber('1')">1</button>
        <button class="btn" onclick="appendNumber('2')">2</button>
        <button class="btn" onclick="appendNumber('3')">3</button>
        <button class="btn operator" onclick="setOperator('+')">+</button>

        <button class="btn zero" onclick="appendNumber('0')">0</button>
        <button class="btn" onclick="appendNumber('.')">.</button>
        <button class="btn operator" onclick="calculate()">=</button>
    </div>
</div>

<script>
let currentValue = "0";
let previousValue = null;
let operator = null;
let shouldReset = false;

const display = document.getElementById("display");

function updateDisplay() {
    display.innerText = currentValue;
}

function appendNumber(num) {
    if (shouldReset) {
        currentValue = num;
        shouldReset = false;
    } else {
        if (num === "." && currentValue.includes(".")) return;
        currentValue = currentValue === "0" ? num : currentValue + num;
    }
    updateDisplay();
}

function setOperator(op) {
    if (operator !== null) calculate();
    previousValue = currentValue;
    operator = op;
    shouldReset = true;
}

function calculate() {
    if (operator === null || previousValue === null) return;

    let a = parseFloat(previousValue);
    let b = parseFloat(currentValue);
    let result = 0;

    switch (operator) {
        case "+": result = a + b; break;
        case "-": result = a - b; break;
        case "*": result = a * b; break;
        case "/": result = b === 0 ? "Error" : a / b; break;
    }

    currentValue = result.toString();
    operator = null;
    previousValue = null;
    shouldReset = true;
    updateDisplay();
}

function clearAll() {
    currentValue = "0";
    previousValue = null;
    operator = null;
    shouldReset = false;
    updateDisplay();
}

function backspace() {
    if (shouldReset) return;
    currentValue =
        currentValue.length > 1
            ? currentValue.slice(0, -1)
            : "0";
    updateDisplay();
}

function percent() {
    currentValue = (parseFloat(currentValue) / 100).toString();
    updateDisplay();
}
</script>

</body>
</html>
